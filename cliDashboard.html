<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLI Dashboard</title>
    <style>
        /* Basic styling for tabs */
        .tabs {
            display: flex;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
            flex-wrap: wrap; /* Allows tabs to stack on smaller screens */
        }
        .tab {
            padding: 10px 20px;
            margin-right: 10px;
            background-color: #f2f2f2;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .tab.active {
            background-color: #d3d3d3;
        }

        /* Table styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }

        /* Filter and button styling */
        .filters {
            margin-top: 20px;
            display: flex;
            flex-direction: column; /* Stack filters vertically */
        }
        .filter-label {
            margin-top: 10px; /* Spacing before each label */
        }
        .filter-select,
        .filter-date {
            padding: 5px;
            margin: 5px 0 10px 0; /* Margin for spacing around selects */
            width: 100%; /* Full width for responsive design */
            box-sizing: border-box; /* Include padding in width calculations */
        }
        .button-container {
            margin-top: 20px;
        }
        
        @media (max-width: 600px) {
            .tabs {
                flex-direction: column; /* Stack tabs vertically on smaller screens */
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Welcome, <span id="usernameDisplay"></span></h1>

    <!-- Tab navigation -->
    <div class="tabs">
        <div id="footplateTab" class="tab active">Footplate</div>
        <div id="cvvrsTab" class="tab">CVVRS</div>
        <div id="spmTab" class="tab">SPM</div>
        <div id="rrTab" class="tab">RR</div>
        <div id="lobbyTab" class="tab">Lobby</div>
        <div id="stablingTab" class="tab">Stabling</div>
        <div id="nominatedTab" class="tab">Nominated</div>
    </div>

    <!-- Row count display -->
    <div id="rowCount">Rows: 0</div>

    <!-- Table to display data -->
    <h3>Data:</h3>
    <table id="dataTable">
        <thead>
            <!-- Columns will be dynamically inserted here -->
        </thead>
        <tbody>
            <!-- Data will be dynamically inserted here -->
        </tbody>
    </table>

    <!-- Action buttons -->
    <div class="button-container">
        <button id="clearFilters">Clear Filters</button>
        <button id="printTable">Print Table</button>
        <button id="downloadTable">Download CSV</button>
    </div>
</div>

<script>
    // Define Google Sheet URLs for each tab
    const sheetURLs = {
        footplate: {
            sheetID: '1HDBieARU2yEJZGAqus4S1JfF_oECrzbwADfyNY42rCM',
            range: 'Sheet1!A1:AQ1000',
        },
        cvvrs: {
            sheetID: '1yrii3lXVs_DydQKFIlYyPBS4WSJdymC1YoP8AZpSCNk',
            range: 'Sheet1!A1:AP1000',
        },
        spm: {
            sheetID: '1Q7SinsMgE-lbHLK4LbISxsoM49kyxQl2fwS5RHG_zTI',
            range: 'Sheet1!A1:AD1000',
        },
        rr: {
            sheetID: '1vnPgIYJqVA_n3mRvdjGq4_gFBGCG-lk8-XQ4PBzHTaA',
            range: 'Sheet1!A1:I1000',
        },
        lobby: {
            sheetID: '1vnPgIYJqVA_n3mRvdjGq4_gFBGCG-lk8-XQ4PBzHTaA',
            range: 'Sheet1!J1:R1000',
        },
        stabling: {
            sheetID: '1vnPgIYJqVA_n3mRvdjGq4_gFBGCG-lk8-XQ4PBzHTaA',
            range: 'Sheet1!S1:AA1000',
        },
        nominated: {
            sheetID: '1MFtqC6Gq17KN6-afXXH1I8oIT3JfJ1qRiOh0dOj-S58',
            range: 'Sheet1!A1:I1000',
        },
    };

    // Get the username from the URL query parameters
    const urlParams = new URLSearchParams(window.location.search);
    const username = urlParams.get('user');
    document.getElementById('usernameDisplay').textContent = username;

    let currentTab = 'footplate'; // Default tab is footplate
    let currentData = [];

    // Function to fetch data from Google Sheets based on the selected tab
    function fetchDataFromGoogleSheet(sheetType) {
        const sheet = sheetURLs[sheetType];
        const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheet.sheetID}/values/${sheet.range}?key=AIzaSyBG5Y_6PX9WT-0Mu5-Wv8Z9hA6ATF3TqR0`; // Replace with actual API key

        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                if (data.values) {
                    const rows = data.values;
                    const tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
                    const tableHead = document.getElementById('dataTable').getElementsByTagName('thead')[0];

                    // Clear previous table data
                    tableBody.innerHTML = '';
                    tableHead.innerHTML = '';

                    // Get column headers from the first row
                    const headers = rows[0];

                    // Insert table headers dynamically
                    let headerRow = tableHead.insertRow();
                    headers.forEach(header => {
                        let th = document.createElement('th');
                        th.textContent = header;
                        headerRow.appendChild(th);
                    });

                    // Filter data based on logged-in user
                    if (sheetType === 'nominated') {
                        currentData = rows.filter(row => row[0] === username); // Username in column 0 for "Nominated"
                    } else {
                        currentData = rows.filter(row => row[2] === username); // Username in column 2 for other sheets
                    }

                    // Add rows to the table
                    currentData.forEach(row => {
                        let newRow = tableBody.insertRow();
                        row.forEach(cell => {
                            let newCell = newRow.insertCell();
                            newCell.textContent = cell || ''; // Handle empty cells
                        });

                        // Highlight rows only for "Nominated" tab
                        if (sheetType === 'nominated') {
                            const lastColumnValue = parseFloat(row[headers.length - 1]); // Apply color coding to the last column
                            if (!isNaN(lastColumnValue)) {
                                if (lastColumnValue >= 6 && lastColumnValue <= 10) {
                                    newRow.style.backgroundColor = 'yellow';
                                } else if (lastColumnValue >= 3 && lastColumnValue < 6) {
                                    newRow.style.backgroundColor = 'orange';
                                } else if (lastColumnValue < 3) {
                                    newRow.style.backgroundColor = 'red';
                                }
                            }
                        }
                    });

                    // Update row count
                    document.getElementById('rowCount').textContent = `Rows: ${currentData.length}`;

                    // Hide filters, since they were removed with Fortnight tab
                } else {
                    alert('No data found.');
                }
            })
            .catch(error => {
                console.error('Error fetching Google Sheet data:', error);
                alert('Error fetching data from Google Sheets.');
            });
    }

    // Update tab switching logic
    function switchTab(tabId) {
        // Remove active class from all tabs
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => tab.classList.remove('active'));

        // Add active class to the clicked tab
        const tabElement = document.getElementById(tabId);
        tabElement.classList.add('active');
        currentTab = tabId.replace('Tab', '').toLowerCase(); // Adjust to match keys in sheetURLs

        // Fetch data for selected tab
        fetchDataFromGoogleSheet(currentTab);
    }

    // Event listeners for the tabs
    document.getElementById('footplateTab').addEventListener('click', () => switchTab('footplateTab'));
    document.getElementById('cvvrsTab').addEventListener('click', () => switchTab('cvvrsTab'));
    document.getElementById('spmTab').addEventListener('click', () => switchTab('spmTab'));
    document.getElementById('rrTab').addEventListener('click', () => switchTab('rrTab'));
    document.getElementById('lobbyTab').addEventListener('click', () => switchTab('lobbyTab'));
    document.getElementById('stablingTab').addEventListener('click', () => switchTab('stablingTab'));
    document.getElementById('nominatedTab').addEventListener('click', () => switchTab('nominatedTab'));

    // Initial load
    fetchDataFromGoogleSheet(currentTab);

</script>

</body>
</html>