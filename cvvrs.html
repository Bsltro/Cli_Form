<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CVVRS Form</title>
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: 'Times New Roman', Times, serif;
            }
        
            /* body {
                background-color: aqua;
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                background-repeat: no-repeat;
                padding: 20px;
            } */
            body {
    font-family: Arial, sans-serif;
    background-color: aqua;
    padding: 20px;
    justify-content: center;
    align-items: center;
}
.main {
                width: 100%;
                max-width: 400px;
                background: rgb(245, 242, 242);
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                text-align: center;
            }
        
            .main h3 {
                padding-bottom: 20px;
                font-size: 30px;
                color: #333;
            }
        
            .main form {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
        
            /* .form-outer {
                width: 100%;
                margin-bottom: 20px;
            } *//* Form Outer Container */
.form-outer {
    margin-bottom: 15px;
}
        
.form-outer label {
    display: block;
    font-size: 16px;
    margin-bottom: 5px;
}
        
            .form-outer input {
                width: 100%;
                height: 40px;
                padding: 8px;
                background-color: rgb(203, 218, 223);
                border: 1px solid #ccc;
                border-radius: 4px;
                font-size: 16px;
            }
        
            .form-outer button {
                width: 100%;
                padding: 12px;
                background-color: blueviolet;
                color: white;
                font-size: 18px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                transition: background-color 0.3s ease;
            }
        
            .form-outer button:hover {
                background-color: darkviolet;
            }
        
            /* For mobile responsiveness */
            @media (max-width: 600px) {
                .main {
                    padding: 15px;
                    width: 100%;
                    max-width: 100%;
                }
        
                .form-outer input,
                .form-outer button {
                    height: 45px;
                    font-size: 16px;
                }
        
                .main h3 {
                    font-size: 26px;
                }
        
                .form-outer label {
                    font-size: 14px;
                }
            }
        
            .dropbtn {
                background-color: #04AA6D;
                color: white;
                padding: 16px;
                font-size: 16px;
                border: none;
                cursor: pointer;
            }  /* General Styling */
body {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    padding: 20px;
}

/* Form Outer Container */
.form-outer {
    margin-bottom: 15px;
}

/* Label Styling */
.form-outer label {
    display: block;
    font-size: 16px;
    margin-bottom: 5px;
}

/* Dropdown Styling */
.form-outer select {
    width: 100%;
    max-width: 500px;  /* Adjust for large screens */
    padding: 12px;
    font-size: 16px;
    border: 2px solid #4CAF50;
    border-radius: 6px;
    background-color: #fff;
    color: #333;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
}

/* Hover & Focus Effects */
.form-outer select:hover, 
.form-outer select:focus {
    border-color: #2E7D32;
    background-color: #f0fff0;
}

/* Mobile Friendly */
@media (max-width: 600px) {
    .form-outer select {
        font-size: 14px;
        padding: 10px;
    }
}

        </style>
      </head>
    <form id="tab2" class="tabcontent">
        <div id="res" style="color: brown;font-size: 14px;" class="tabcontent">
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">CLI ID<b style="color: blue;">**Enter last digits of CLI CMS ID Only,ex if CLI CMS ID is BSL0048 enter only 48,ex if CLI CMS ID is BSL0106 enter only 106**</b></p></label>
                <input type="number" name="cvvrsinspectionid" id="cvvrsinspectionid" required>
            </div>
            <div class="form-outer">
                <label>CVVRS DATA SENT DATE</label>
                <input type="date" name="cvvrsinspectiondate" id="cvvrsinspectiondate" >
            </div>
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">CLI Name</label>
                <input type="text" name="cvvrscliname" id="cvvrscliname"  >
            </div>
            <div class="form-outer">
                <label for="trainNumber">Train Number:</label>
                <input type="text" name="cvvrsTrainNumber" id="cvvrsTrainNumber" placeholder="Enter train number" class="uppercase">
            </div>
            <!-- <div class="form-outer">
                <label for="trainLoad">Train Load (in Tonn):</label>
                <input type="number" name="cvvrsTrainLoad" id="cvvrsTrainLoad" placeholder="Enter train load" >
            </div> -->
            <div class="form-outer">
                <label for="trainNumber">LOCO Number:</label>
                <input type="text" name="cvvrslocono" id="cvvrslocono" placeholder="Enter train number" class="uppercase">
            </div>
            
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">From Station<p><b style="color: blue;">**Enter Station Code Only**</b></p></label>
                <input type="text" name="cvvrsfromstation" id="cvvrsfromstation" oninput="upperCase()" class="uppercase">
            </div>
            <div class="form-outer">
                <label>Train Date and CVVRS START Time</label>
                <input type="datetime-local" name="cvvrsstarttime" id="cvvrsstarttime">
            </div>
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">To Station<p style="color: blue;"><b>**Enter Station Code Only**</b></p></label>
                <input type="text" name="cvvrstostation" id="cvvrstostation"  class="uppercase">
            </div>
            <div class="form-outer">
                <label>Train Date and CVVRS END Time</label>
                <input type="datetime-local" name="cvvrsendtime" id="cvvrsendtime">
            </div>
            <script>
                const startTimeInput = document.getElementById('cvvrsstarttime');
                const endTimeInput = document.getElementById('cvvrsendtime');
                
                endTimeInput.addEventListener('change', function() {
                    const startTime = new Date(startTimeInput.value);
                    const endTime = new Date(endTimeInput.value);
                    
                    if (startTime && endTime && endTime <= startTime) {
                        alert('End time cannot be less than or equal to start time. Please select a NEXT date.');
                        endTimeInput.value = ''; // Clear the invalid end time input
                    }
                });
            </script>
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">LP CMS ID</label>
                <input type="text" name="cvvrslpcmsid" id="cvvrslpcmsid">
            </div>
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">LP Name</label>
                <input type="text" name="cvvrslpname" id="cvvrslpname">
            </div>
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">LP Designation</label>
                <input type="text" name="cvvrslptype" id="cvvrslptype">
            </div>
            <!-- <div class="form-outer">
                <label style="color: red; font-weight: bold;">LP Category</label>
                <input type="text" name="cvvrslpcat" id="cvvrslpcat">
            </div> -->
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">LP HQ</label>
                <input type="text" name="cvvrslphq" id="cvvrslphq">
            </div>
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">ALP CMS ID</label>
                <input type="text" name="cvvrsalpcmsid" id="cvvrsalpcmsid">
            </div>
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">ALP Name</label>
                <input type="text" name="cvvrsalpname" id="cvvrsalpname">
            </div><br>
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">ALP Designation</label>
                <input type="text" name="cvvrsalpdesg" id="cvvrsalpdesg" value="ALP">
            </div>
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">ALP HQ</label>
                <input type="text" name="cvvrsalphq" id="cvvrsalphq">
            </div>
            <div class="form-outer">
                <label>CVVRS INSPECTION DATE</label>
                <input type="date" name="cvvrsdatasentdt" id="cvvrsdatasentdt">
                </div>
                <div class="form-outer">
                    <label for="knowledge" style="color: red; font-weight: bold;">Whether Keeping Necessary Personal Store Items On Desk</label>
                    <select name="cvvrsps" id="cvvrsps" onchange="handleSelectionChange(this)">
                        <option value="select">-------Select Personal Store Of Crew-------</option>
                        <option value="YES">YES</option>
                        <option value="NO">NO</option>
                     </select>
                </div>
                <div class="form-outer">
                    <label for="knowledge" style="color: red; font-weight: bold;">Whether conducted brake continuity test before starting from initial station and after attatchment or detatchment of vehicles</label>
                    <select name="cvvrscont" id="cvvrscont" onchange="handleSelectionChange(this)">
                        <option value="select">-------Select -------</option>
                        <option value="YES">YES</option>
                        <option value="NO">NO</option>
                        <option value="N/A">N/A</option>
                    </select>
                </div>
                <div class="form-outer">
                    <label for="knowledge" style="color: red; font-weight: bold;">Whether LP Signal Calling Out SIGNAL With Hand Gesture</label>
                    <select name="cvvrslpsig" id="cvvrslpsig" onchange="handleSelectionChange(this)">
                        <option value="select">-------Select -------</option>
                        <option value="YES">YES</option>
                        <option value="NO">NO</option>
                     </select>
                </div>
                <div class="form-outer">
                    <label for="knowledge" style="color: red; font-weight: bold;">Whether ALP calling out the correct aspect of signals with hand gesture along with signal name/number and train speed loudly and LP acknowledging the same. Also calling out acknowledging next halts.TSR/PSR/Neutral section locations enroute</label>
                    <select name="cvvrsalpsig" id="cvvrsalpsig" onchange="handleSelectionChange(this)">
                        <option value="select">-------Select -------</option>
                        <option value="YES">YES</option>
                        <option value="NO">NO</option>
                        <option value="N/A">NOT APPLICABLE</option>
                    </select>
                </div>
                <div class="form-outer">
                        <label for="knowledge" style="color: red; font-weight: bold;">Whether conducted Brake feel test/Brake power test at first opportunity</label>
                        <select name="cvvrsbft" id="cvvrsbft" onchange="handleSelectionChange(this)">
                            <option value="select">-------Select -------</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                            <option value="N/A">NOT APPLICABLE</option>
                        </select>
                    </div>
                    <script>
                        function handleSelectionChange(selectElement) {
                            var value = selectElement.value;
                            if (value === 'NO') {
                                alert('You have selected option, it will be considered as irregularity.');
                            } 
                        }
                    </script>
                    <div class="form-outer">
                        <label for="knowledge" style="color: red; font-weight: bold;">Whether LP reducing speed proportionately in case signal aspect is restrictive and not presuming the aspect of next signal</label>
                        <select name="cvvrssp" id="cvvrssp" onchange="handleSelectionChange(this)">
                            <option value="select">-------Select -------</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                            <option value="N/A">NOT APPLICABLE</option>
                       </select>
                    </div>
                    <script>
                        function handleSelectionChange(selectElement) {
                            var value = selectElement.value;
                            if (value === 'NO') {
                                alert('You have selected option, it will be considered as irregularity.');
                            } 
                        }
                    </script>
                    <div class="form-outer">
                        <label for="knowledge" style="color: red; font-weight: bold;">Whether ALP keeping hand on emergency brakes D-1 pilot/RS valve when passing yellow signal and opening D-1 pilot/RS valve in case LP no vigilant</label>
                        <select name="cvvrsrs" id="cvvrsrs" onchange="handleSelectionChange(this)">
                            <option value="select">-------Select -------</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                            <option value="N/A">NOT APPLICABLE</option>
                        </select>
                    </div>
                   <div class="form-outer">
                        <label for="knowledge" style="color: red; font-weight: bold;">Whether crew not using walkie-talkie to get information about signal aspect or other operational instructions from station staff during train operation</label>
                        <select name="cvvrswt" id="cvvrswt" onchange="handleSelectionChange(this)">
                            <option value="select">-------Select -------</option>
                            <option value="YES NOT USING">YES NOT USING</option>
                            <option value="NO">NO</option>
                         </select>
                    </div>
                    <div class="form-outer">
                        <label for="knowledge" style="color: red; font-weight: bold;">Whether whistling at W and WL board, while running through stations & at trespassing location</label>
                        <select name="cvvrswl" id="cvvrswl" onchange="handleSelectionChange(this)">
                            <option value="select">-------Select -------</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                            <option value="N/A">NOT APPLICABLE</option>
                        </select>
                    </div>
                   <div class="form-outer">
                        <label for="knowledge" style="color: red; font-weight: bold;">Whether putting Reverser/Direction Switch & PBC/Throttle in neutral position when halted bat Red Signal</label>
                        <select name="cvvrsth" id="cvvrsth" onchange="handleSelectionChange(this)">
                            <option value="select">-------Select -------</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                        </select>
                    </div>
                    <div class="form-outer">
                        <label for="knowledge" style="color: red; font-weight: bold;">Whether crew being vigilant and focussing only on safe operation and not discussing personal problems/Un-necessary talk during train operation</label>
                        <select name="cvvrsdis" id="cvvrsdis" onchange="handleSelectionChange(this)">
                            <option value="select">-------Select -------</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                        </select>
                    </div>
                    <div class="form-outer">
                        <label for="knowledge" style="color: red; font-weight: bold;">Whether crew ensuring proper signal for their trains OFF/authority received before starting train and observing the aspect till passing the signal </label>
                        <select name="cvvrssigtoff" id="cvvrssigtoff" onchange="handleSelectionChange(this)">
                            <option value="select">-------Select -------</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                        </select>
                    </div>   
                    <div class="form-outer">
                        <label for="knowledge" style="color: red; font-weight: bold;">Whether LP/ALP NOT using mobile phones for while on run. Footplating officers/Supervisors should also not using mobile phone </label>
                        <select name="cvvrsmob" id="cvvrsmob" onchange="handleSelectionChange(this)">
                            <option value="select">-------Select -------</option>
                            <option value="YES">YES NOT USING</option>
                            <option value="NO">NO</option>
                        </select>
                    </div>
                    <div class="form-outer">
                        <label for="knowledge" style="color: red; font-weight: bold;">Whether safety devise like VCD not isolated on line by CREW and acknowledge VCD warning in time</label>
                        <select name="cvvrsvcd" id="cvvrsvcd" onchange="handleSelectionChange(this)">
                            <option value="select">-------Select -------</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                        </select>
                    </div>
                    <div class="form-outer">
                        <label for="knowledge" style="color: red; font-weight: bold;">Whether LP bringing MP to '0'(ZERO) notch before applying of A-9 & SA-9</label>
                        <select name="cvvrsmp" id="cvvrsmp" onchange="handleSelectionChange(this)">
                            <option value="select">-------Select -------</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                            
                        </select>
                    </div>
                   <div class="form-outer">
                    <label for="knowledge" style="color: red; font-weight: bold;">Whether collecting personal store items before reaching destination</label>
                    <select name="cvvrslugg" id="cvvrslugg" onchange="handleSelectionChangeps(this)">
                        <option value="select">-------Select -------</option>
                        <option value="NO">NO</option>
                        <option value="YES">YES</option>
                    </select>
                </div>
                <script>
                    function handleSelectionChangeps(selectElement) {
                        var value = selectElement.value;
                        if (value === 'YES') {
                            alert('You have selected option, it will be considered as irregularity.');
                        } 
                    }
                </script>
            <div class="form-outer">
                <label style="color: red; font-weight: bold;">REMARK</label>
                <input type="text" name="cvvrsremark" id="cvvrsremark">
            </div>
            <br>
            <p style="text-align: center; font-weight: bolder;">---------------------------------------------------</p><br>
            <div class="form-outer">
                <input type="submit" id="sub2" style="background: #140149;color: rgb(247, 243, 243); height: 70px; font-size: x-large;">
            </div>
        </div>
    </form>

    <script>
        const sheetIDcvvrs = '1bGIcj3rrwJANyo3LOgiYxvXtjLmA_jLb3j2Ol0Mtd08';
        const apiKeycvvrs = 'AIzaSyBG5Y_6PX9WT-0Mu5-Wv8Z9hA6ATF3TqR0';
        const dataRangecvvrs = 'Sheet1!A2:Z2000'; 
    
        const sheetURL = `https://sheets.googleapis.com/v4/spreadsheets/${sheetIDcvvrs}/values/${dataRangecvvrs}?key=${apiKeycvvrs}`;
    
        // Fetch data from Google Sheets
        function fetchSheetDatacvvrs() {
            fetch(sheetURL)
                .then(response => response.json())
                .then(data => {
                    const rows = data.values;
                    window.sheetData = rows;
                    populateNamescvvrs();
                })
                .catch(error => console.error('Error fetching data from Google Sheets:', error));
        }
    
        // Populate Loco Pilot and Assistant Loco Pilot names
        function populateNamescvvrs() {
            const lpNames = document.getElementById('cvvrslpnames');
            const alpNames = document.getElementById('cvvrsalpnames');
            lpNames.innerHTML = '';
            alpNames.innerHTML = '';
    
            window.sheetData.forEach(row => {
                const lpOption = document.createElement('option');
                lpOption.value = row[2];  // Loco Pilot Name (column C)
                lpNames.appendChild(lpOption);
    
                const alpOption = document.createElement('option');
                alpOption.value = row[6]; // Assistant Loco Pilot Name (column G)
                alpNames.appendChild(alpOption);
            });
        }
    
        // Auto-fill fields based on LP CMS ID
        document.getElementById('cvvrslpcmsid').addEventListener('input', function() {
            const lpcmsid = document.getElementById('cvvrslpcmsid').value;
            if (!lpcmsid) return;
    
            const matchingRow = window.sheetData?.find(row => row[2] === lpcmsid); // Assumes LP CMS ID is in column I (index 8)
    
            if (matchingRow) {
                document.getElementById('cvvrslpname').value = matchingRow[3]; // LP Name (column C)
                document.getElementById('cvvrslptype').value = matchingRow[4]; // LP Type (column D)
                //document.getElementById('cvvrslpcat').value = matchingRow[5]; // LP Category (column E)
                document.getElementById('cvvrslphq').value = matchingRow[6]; // LP HQ (column F)
            } else {
                clearLPFields();
            }
        });
    
        // Clear LP fields
        function clearLPFields() {
            document.getElementById('cvvrslpname').value = '';
            document.getElementById('cvvrslptype').value = '';
            //document.getElementById('cvvrslpcat').value = '';
            document.getElementById('cvvrslphq').value = '';
        }
    
        // Auto-fill fields based on ALP CMS ID
        document.getElementById('cvvrsalpcmsid').addEventListener('input', function() {
            const alpcmsid = document.getElementById('cvvrsalpcmsid').value;
            if (!alpcmsid) return;
    
            const matchingRow = window.sheetData?.find(row => row[7] === alpcmsid); // Assumes ALP CMS ID is in column J (index 9)
    
            if (matchingRow) {
                document.getElementById('cvvrsalpname').value = matchingRow[8]; // ALP Name (column G)
                //document.getElementById('cvvrsalpdesg').value = matchingRow[9]; // ALP Designation (assuming it's in column K, index 10)
                document.getElementById('cvvrsalphq').value = matchingRow[10]; // ALP HQ (column H)
            } else {
                clearALPFields();
            }
        });
    
        // Clear ALP fields
        function clearALPFields() {
            document.getElementById('cvvrsalpname').value = '';
            //document.getElementById('cvvrsalpdesg').value = '';
            document.getElementById('cvvrsalphq').value = '';
        }
    
        // Auto-fill CLI Name and Inspection Date based on Inspection ID
        document.getElementById('cvvrsinspectionid').addEventListener('input', autoFillDetailscvvrs);
    
        function autoFillDetailscvvrs() {
            const inspectionID = document.getElementById('cvvrsinspectionid').value;
            if (!inspectionID) return;
    
            const matchingRow = window.sheetData?.find(row => row[0] == inspectionID);
    
            if (matchingRow) {
                document.getElementById('cvvrscliname').value = matchingRow[1]; // CLI Name (column B)
                //const today = new Date().toISOString().split('T')[0]; // Format as YYYY-MM-DD
                //document.getElementById('cvvrsinspectiondate').value = today; // Set today's date
            }
        }
    
        // Set radio buttons based on input values
        
        // Initial load function
        window.onload = () => {
            fetchSheetDatacvvrs();
        };
    
        const form = document.getElementById('tab2');
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (!form.checkValidity()) {
                alert("Please fill all the required fields.");
                return;
            }
            document.querySelector("#sub2").value = "Submitting.........";
    
            // Create a new FormData object
            let data = new FormData(form);
    
            // Convert all form data values to uppercase
            data.forEach((value, key) => {
                if (typeof value === 'string') {
                    data.set(key, value.toUpperCase());
                }
            });
    
            // Send the data to the server
            fetch('https://script.google.com/macros/s/AKfycbxboowU3pHMFWoQ5JpuFmZ1yTbxKAqx-78oet5E-1ohTH61uyjtL9cE6rRnwbBSeCkEWg/exec', {
                method: "POST",
                body: data
            })
            .then(res => res.text())
            .then(data => {
                document.querySelector("#sub2").value = "Submit";
                form.reset();
                alert("cvvrs Data Saved Successfully...");
            })
            .catch(error => {
                document.querySelector("#sub2").value = "Submit";
                alert("An error occurred while saving the data. Please try again.");
                console.error(error);
            });
        });
    
    //     function handleSelectionChange(selectElement) {
    //     var irregularOptions = [
    //         "NO", //PS
    //         "NO", //CONT
    //         "NO",//SIG
    //         "NO",//BFT,BPT
    //         "NO",//RED SPD AT 1Y
    //         "NO",//HAND ON RS
    //         "NO",//WT
    //         "NO",//W
    //         "NO",//REV
    //         "NO",//VIG
    //         "NO",//SIG OFF
    //         "NO",//MOBILE
    //         "NO",//VCD
    //         "NO",//MP
    //         "YES"//PS
            
    //     ];

    //     if (irregularOptions.includes(selectElement.value)) {
    //         alert("You have selected an option that will be considered as irregularity.");
    //     }
    // }
    </script>
</html>